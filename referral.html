<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deepak Chauhan √ó AI Bhai ‚Äî Referral Program</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #10b981;
      --dark: #0f172a;
      --darker: #0b1220;
      --card-dark: #1e293b;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --accent: #3b82f6;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border: #334155;
      --gradient-start: #6366f1;
      --gradient-end: #8b5cf6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
      background: var(--darker);
      color: var(--text);
      line-height: 1.6;
      background-image: 
        radial-gradient(circle at 15% 50%, rgba(37, 99, 235, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 85% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 20%);
    }
    
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 22px;
      color: var(--text);
    }
    
    .logo i {
      color: var(--accent);
    }
    
    .user-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--card-dark);
      padding: 8px 16px;
      border-radius: 50px;
      border: 1px solid var(--border);
    }
    
    .user-badge i {
      color: var(--accent);
    }
    
    /* Card Styles */
    .card {
      background: var(--card-dark);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      border: 1px solid var(--border);
    }
    
    .section-title {
      font-size: 20px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title i {
      color: var(--accent);
    }
    
    /* Referral Code Box */
    .referral-box {
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .referral-box h3 {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .referral-code {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 2px;
      background: rgba(0, 0, 0, 0.2);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin: 8px 0;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    input, select, button {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--dark);
      color: var(--text);
      font-size: 16px;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--card-dark);
      border: 1px solid var(--border);
    }
    
    .btn-secondary:hover {
      background: var(--dark);
    }
    
    .btn-success {
      background: var(--success);
    }
    
    .btn-success:hover {
      background: #16a34a;
    }
    
    /* Grid System */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    
    @media (max-width: 968px) {
      .grid-3 {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }
    
    /* Stats Cards */
    .stat-card {
      background: linear-gradient(to bottom right, var(--card-dark), var(--dark));
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .stat-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(59, 130, 246, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
    }
    
    .stat-title {
      font-size: 14px;
      color: var(--text-muted);
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
    }
    
    .progress-bar {
      height: 10px;
      background: var(--dark);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 8px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
      border-radius: 5px;
      width: 0%;
      transition: width 0.5s ease;
    }
    
    /* Leaderboard */
    .leaderboard-top {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .leaderboard-top {
        grid-template-columns: 1fr;
      }
    }
    
    .leader-item {
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      background: var(--card-dark);
      border: 1px solid var(--border);
    }
    
    .rank-1 {
      background: linear-gradient(to bottom, #fde047, #eab308);
      color: #1f2937;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(234, 179, 8, 0.3);
    }
    
    .rank-2 {
      background: linear-gradient(to bottom, #e5e7eb, #9ca3af);
      color: #1f2937;
    }
    
    .rank-3 {
      background: linear-gradient(to bottom, #fbcfe8, #f472b6);
      color: #1f2937;
    }
    
    .rank-badge {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 10px;
    }
    
    .leader-score {
      font-weight: 700;
      font-size: 18px;
      margin-top: 8px;
    }
    
    .leaderboard-list {
      list-style: none;
    }
    
    .leaderboard-list li {
      display: flex;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      align-items: center;
    }
    
    .leaderboard-list li:last-child {
      border-bottom: none;
    }
    
    .list-rank {
      font-weight: 700;
      width: 30px;
      color: var(--text-muted);
    }
    
    .list-name {
      flex: 1;
    }
    
    .list-score {
      font-weight: 600;
      color: var(--accent);
    }
    
    /* Wallet */
    .wallet-list {
      list-style: none;
    }
    
    .wallet-list li {
      display: flex;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      align-items: center;
    }
    
    .wallet-list li:last-child {
      border-bottom: none;
    }
    
    .transaction-credit {
      color: var(--success);
    }
    
    .transaction-debit {
      color: var(--danger);
    }
    
    /* Utility Classes */
    .text-muted {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mt-20 {
      margin-top: 20px;
    }
    
    .mb-20 {
      margin-bottom: 20px;
    }
    
    .hide {
      display: none !important;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 600;
      background: var(--dark);
      border: 1px solid var(--border);
    }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card {
      animation: fadeIn 0.5s ease;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--accent);
      color: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head> 
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <i class="fas fa-rocket"></i>
        <span>Deepak Chauhan √ó AI Bhai</span>
      </div>
      
      <div class="user-badge" id="loginInfo">
        <i class="fas fa-user"></i>
        <span>Guest</span>
      </div>
    </header>

    <a href="https://deepakchauhanxai.com/referral_about.html" 
   style="padding:10px 20px; border-radius:8px; border:1px solid #2dd4bf; 
          color:#2dd4bf; font-weight:600; text-decoration:none; display:inline-block;">
   ‚ÑπÔ∏è About AI Bhai
    </a>
    <div class="card">
      <div class="referral-box">
        <h3><i class="fas fa-gift"></i> ‡§Ü‡§™‡§ï‡§æ Referral Code</h3>
        <div class="referral-code" id="refView">‚Äî</div>
        <p class="text-center">‡§≤‡§ø‡§Ç‡§ï ‡§∏‡•á ‡§Ü‡§è ‡§π‡•ã ‡§§‡•ã ‡§Ö‡§™‡§®‡•á‚Äë‡§Ü‡§™ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à</p>
      </div>
    </div>

    <!-- AUTH BLOCKS -->
    <div class="card" id="authBlock">
      <h3 class="section-title"><i class="fas fa-user-circle"></i> Sign up / Login</h3>
      
      <div class="tabs">
        <div class="tab active" data-tab="signup">‡§®‡§Ø‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü</div>
        <div class="tab" data-tab="login">Login</div>
      </div>

      <!-- Signup -->
      <div class="tab-content active" id="signupTab">
        <div class="grid-2">
          <div class="form-group">
            <label class="form-label">‡§®‡§æ‡§Æ</label>
            <input id="su_name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ" />
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input id="su_email" type="email" placeholder="email@example.com" />
          </div>
        </div>
        
        <div class="grid-2">
          <div class="form-group">
            <label class="form-label">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (6+ ‡§Ö‡§ï‡•ç‡§∑‡§∞)</label>
            <input id="su_pass" type="password" placeholder="‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" />
          </div>
          <div class="form-group">
            <label class="form-label">OTP (6 digit)</label>
            <div class="grid-2" style="gap: 10px;">
              <button id="su_getotp" class="btn-secondary"><i class="fas fa-key"></i> Get OTP</button>
              <input id="su_otp" placeholder="123456" />
            </div>
          </div>
        </div>
        
        <button id="btnSignup" class="btn btn-success"><i class="fas fa-user-plus"></i> Create Account</button>
        <div class="text-muted mt-20" id="signupMsg"></div>
      </div>

      <!-- Login -->
      <div class="tab-content" id="loginTab">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input id="li_email" type="email" placeholder="email@example.com" />
        </div>
        
        <div class="form-group">
          <label class="form-label">OTP (6 digit)</label>
          <div class="grid-2" style="gap: 10px;">
            <button id="li_getotp" class="btn-secondary"><i class="fas fa-key"></i> Get OTP</button>
            <input id="li_otp" placeholder="123456" />
          </div>
        </div>
        
        <button id="btnLogin" class="btn"><i class="fas fa-sign-in-alt"></i> Login</button>
        <div class="text-muted mt-20" id="loginMsg"></div>
      </div>
    </div>

    <!-- Logged summary -->
    <div class="card hide" id="loggedCard">
      <h3 class="section-title"><i class="fas fa-user-check"></i> Your Profile</h3>
      <div class="grid-2">
        <div>
          <p><strong>Logged in as:</strong> <span id="loggedName">‚Äî</span></p>
          <p class="text-muted">Referral Code: <span id="loggedCode" class="badge"></span></p>
        </div>
        <div>
          <button id="btnLogout" class="btn-secondary"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
      <div class="text-muted mt-20" id="shareWrap">
        <p>Your referral link:</p>
        <div class="referral-code" style="font-size: 18px; padding: 10px;" id="shareLink">‚Äî</div>
        <button class="btn btn-secondary mt-20" onclick="copyLink()"><i class="fas fa-copy"></i> Copy Link</button>
      </div>
    </div>

    <!-- Profile -->
    <div class="card">
      <h3 class="section-title"><i class="fas fa-chart-line"></i> ‡§Æ‡•á‡§∞‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</h3>
      <div class="grid-3">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div>
              <div class="stat-title">Direct Joinings</div>
              <div class="stat-value" id="joinings">0</div>
            </div>
          </div>
          <div class="text-muted">Level Progress: 10 ‚Üí 50 ‚Üí 100 ‚Üí 160</div>
          <div class="progress-bar">
            <div class="progress-fill" id="bar"></div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-percentage"></i>
            </div>
            <div>
              <div class="stat-title">Level Rate</div>
              <div class="stat-value"><span id="rate">0</span>%</div>
            </div>
          </div>
          <div class="text-muted">Auto unlock</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div>
              <div class="stat-title">Wallet Balance</div>
              <div class="stat-value">‚Çπ<span id="balance">0.00</span></div>
            </div>
          </div>
          <div class="text-muted"><a href="#wallet" style="color: var(--accent);">History ‡§¶‡•á‡§ñ‡•á‡§Ç</a></div>
        </div>
      </div>
    </div>

    <!-- Leaderboard -->
    <div class="card">
      <h3 class="section-title"><i class="fas fa-trophy"></i> Leaderboard</h3>
      <div class="leaderboard-top" id="top3"></div>
      <ul class="leaderboard-list" id="next7"></ul>
    </div>

    <!-- Wallet -->
    <div class="card" id="wallet">
      <h3 class="section-title"><i class="fas fa-history"></i> Wallet History</h3>
      <ul class="wallet-list" id="walletList"></ul>
    </div>

    <div class="card">
      <h3 class="section-title"><i class="fas fa-gift"></i> Future Features</h3>
      <div class="text-muted">Mega Content / Offers / Campaigns / extra bonus /etc.. ‡§ú‡•Å‡§°‡§º‡•á‡§Ç‡§ó‡•á ‚äÇ‚Å†(‚Å†‚óâ‚Å†‚Äø‚Å†‚óâ‚Å†)‚Å†„Å§ Comming üîú ‚äÇ‚Å†(‚Å†‚óâ‚Å†‚Äø‚Å†‚óâ‚Å†)‚Å†„Å§</div>
    </div>
  </div>

<script>
const API_BASE = 'https://deepakchauhanxai.xyz/referral/api';

// capture ref
(function(){
  const u = new URL(location.href);
  const ref = (u.searchParams.get('ref') || '').toUpperCase();
  if(ref){ localStorage.setItem('ref_code', ref); }
  document.getElementById('refView').textContent = localStorage.getItem('ref_code') || '‚Äî';
})();

// Tab functionality
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
  });
});

// Copy referral link function
function copyLink() {
  const link = document.getElementById('shareLink').textContent;
  navigator.clipboard.writeText(link).then(() => {
    alert('Link copied to clipboard!');
  });
}

// state
let currentEmail = localStorage.getItem('my_email') || '';
let currentName  = localStorage.getItem('my_name')  || '';

function maskEmails(str){
  if(!str) return '';
  const emailRegex=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi;
  return str.replace(emailRegex,'hidden');
}

function setLoggedUI(on){
  document.getElementById('authBlock').classList.toggle('hide', on);
  document.getElementById('loggedCard').classList.toggle('hide', !on);
  document.getElementById('loginInfo').innerHTML = on ? `<i class="fas fa-user"></i><span>${currentName || 'User'}</span>` : '<i class="fas fa-user"></i><span>Guest</span>';
}

// --- SIGNUP (OTP) ---
document.getElementById('su_getotp').onclick = async ()=>{
  const email = document.getElementById('su_email').value.trim().toLowerCase();
  if(!email){ alert('Email ‡§≠‡§∞‡•á‡§Ç'); return; }
  const r = await fetch(API_BASE+'/otp_request.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, purpose:'REGISTER'})});
  const j = await r.json(); alert(j.ok?'OTP sent to email':(j.error||'Error'));
};

document.getElementById('btnSignup').onclick = async ()=>{
  const name = document.getElementById('su_name').value.trim();
  const email = document.getElementById('su_email').value.trim().toLowerCase();
  const password = document.getElementById('su_pass').value;
  const otp_code = document.getElementById('su_otp').value.trim();
  const ref = localStorage.getItem('ref_code') || '';
  const msg = document.getElementById('signupMsg');

  if(!name || !email || password.length<6 || !/^\d{6}$/.test(otp_code)){ msg.innerHTML='<span style="color:var(--danger)">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ + OTP ‡§≠‡§∞‡•á‡§Ç</span>'; return; }

  const res = await fetch(API_BASE+'/register.php', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name,email,password,ref,otp_code})});
  const j = await res.json();
  if(!j.ok){ msg.innerHTML='<span style="color:var(--danger)">'+(j.error||'Error')+'</span>'; return; }

  currentEmail=email; currentName=name;
  localStorage.setItem('my_email',email); localStorage.setItem('my_name',name);
  msg.innerHTML='<span style="color:var(--success)">Account ‡§¨‡§® ‡§ó‡§Ø‡§æ</span>';
  afterLoginUI();
};

// --- LOGIN (OTP) ---
document.getElementById('li_getotp').onclick = async ()=>{
  const email = document.getElementById('li_email').value.trim().toLowerCase();
  if(!email){ alert('Email ‡§≠‡§∞‡•á‡§Ç'); return; }
  const r = await fetch(API_BASE+'/otp_request.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, purpose:'LOGIN'})});
  const j = await r.json(); alert(j.ok?'OTP sent to email':(j.error||'Error'));
};

document.getElementById('btnLogin').onclick = async ()=>{
  const email = document.getElementById('li_email').value.trim().toLowerCase();
  const code  = document.getElementById('li_otp').value.trim();
  const msg = document.getElementById('loginMsg');
  if(!email || !/^\d{6}$/.test(code)){ msg.innerHTML='<span style="color:var(--danger)">Email/OTP ‡§∏‡§π‡•Ä ‡§≠‡§∞‡•á‡§Ç</span>'; return; }

  const r = await fetch(API_BASE+'/login_verify.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, code})});
  const j = await r.json();
  if(!j.ok){ msg.innerHTML='<span style="color:var(--danger)">'+(j.error||'Error')+'</span>'; return; }

  currentEmail=j.data.email; currentName=j.data.name;
  localStorage.setItem('my_email',currentEmail); localStorage.setItem('my_name',currentName);
  msg.innerHTML='<span style="color:var(--success)">Logged in</span>';
  afterLoginUI();
};

// --- After login
async function afterLoginUI(){
  setLoggedUI(true);
  await loadMe();
  await loadWallet();
  await loadLeaderboard();
}

document.getElementById('btnLogout').onclick = ()=>{
  localStorage.removeItem('my_email'); localStorage.removeItem('my_name');
  currentEmail=''; currentName='';
  setLoggedUI(false);
  // ‡§∏‡§æ‡§´ view
  document.getElementById('walletList').innerHTML='';
  document.getElementById('joinings').textContent='0';
  document.getElementById('rate').textContent='0';
  document.getElementById('balance').textContent='0.00';
  document.getElementById('bar').style.width='0%';
};

// --- Me
async function loadMe(){
  if(!currentEmail) return;
  const r = await fetch(API_BASE+'/me.php?email='+encodeURIComponent(currentEmail));
  const j = await r.json(); if(!j.ok) return;
  const me=j.data;

  currentName = me.name || currentName || currentEmail.split('@')[0];
  localStorage.setItem('my_name', currentName);

  setLoggedUI(true);
  document.getElementById('loggedName').textContent=currentName;
  document.getElementById('loginInfo').innerHTML=`<i class="fas fa-user"></i><span>${currentName}</span>`;
  document.getElementById('loggedCode').textContent=me.referral_code;
  const share = location.origin + location.pathname + '?ref=' + me.referral_code;
  document.getElementById('shareLink').textContent = share;

  document.getElementById('joinings').textContent=me.direct_joinings;
  document.getElementById('rate').textContent=me.current_level_rate_percent;
  document.getElementById('balance').textContent=(me.balance_paise/100).toFixed(2);

  const J=me.direct_joinings, cap=J>=160?160: J>=100?100: J>=50?50:10;
  document.getElementById('bar').style.width = Math.min(100, Math.round((J/cap)*100))+'%';
}

// --- Wallet
async function loadWallet(){
  if(!currentEmail) return;
  const r = await fetch(API_BASE+'/wallet_history.php?email='+encodeURIComponent(currentEmail));
  const j = await r.json(); if(!j.ok) return;
  const ul=document.getElementById('walletList'); ul.innerHTML='';
  (j.data.entries||[]).forEach(x=>{
    const ru=(x.amount_paise/100).toFixed(2);
    const sign=x.type==='CREDIT'?'+':'-';
    const safeNote=maskEmails(x.note || x.ref_type);
    const li=document.createElement('li');
    li.innerHTML=`
      <div>
        <div>${safeNote}</div>
        <div class="text-muted">#${x.id}</div>
      </div>
      <div class="${x.type==='CREDIT'?'transaction-credit':'transaction-debit'}">${sign}‚Çπ${ru}</div>
    `;
    ul.appendChild(li);
  });
}

// --- Leaderboard (with client-side fallback sort + joinings display)
async function loadLeaderboard(){
  const r = await fetch(API_BASE + '/leaderboard.php'); 
  const j = await r.json(); 
  if(!j.ok) return;

  // 1) Combine and fallback sort (in case API not sorted correctly)
  let all = [...(j.data.top3 || []), ...(j.data.next7 || [])];

  // normalize
  all = all.map(u => ({
    ...u,
    score_paise: Number(u.score_paise || 0),
    direct_joinings: Number(u.direct_joinings || 0),
    id: Number(u.id || 0),
    name: u.name || 'User'
  }));

  // fallback sort: score desc, joinings desc, id asc
  all.sort((a,b)=>{
    if(a.score_paise !== b.score_paise) return b.score_paise - a.score_paise;
    if(a.direct_joinings !== b.direct_joinings) return b.direct_joinings - a.direct_joinings;
    return a.id - b.id;
  });

  // split back into top3 / next7
  const top3  = all.slice(0,3);
  const next7 = all.slice(3,10);

  // 2) Render
  const fmt = new Intl.NumberFormat('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  const t3 = document.getElementById('top3'); 
  t3.innerHTML = '';
  top3.forEach((u,i)=>{
    const scoreText = u.score_paise > 0 ? ("‚Çπ" + fmt.format(u.score_paise/100)) : "üöÄ Ready to Earn";
    const d = document.createElement('div'); 
    d.className = `leader-item rank-${i+1}`;
    d.innerHTML = `
      <div class="rank-badge">#${i+1}</div>
      <div>${u.name}</div>
      <div class="leader-score">${scoreText} ‚Ä¢ Joinings: ${u.direct_joinings}</div>
    `;
    t3.appendChild(d);
  });

  const n7 = document.getElementById('next7'); 
  n7.innerHTML = '';
  next7.forEach((u,i)=>{
    const scoreText = u.score_paise > 0 ? ("‚Çπ" + fmt.format(u.score_paise/100)) : "üöÄ Ready to Earn";
    const li = document.createElement('li');
    li.innerHTML = `
      <span class="list-rank">#${i+4}</span>
      <span class="list-name">${u.name}</span>
      <span class="list-score">${scoreText} ‚Ä¢ J:${u.direct_joinings}</span>
    `;
    n7.appendChild(li);
  });
}

// boot
(function(){
  const ref = localStorage.getItem('ref_code') || ''; document.getElementById('refView').textContent = ref || '‚Äî';
  if(currentEmail){ setLoggedUI(true); afterLoginUI(); } else { setLoggedUI(false); }
  loadLeaderboard();
})();
</script>
  <!-- ‡§ú‡§π‡§æ‡§Å ‡§≤‡§ó‡§æ‡§®‡§æ ‡§π‡•à ‡§µ‡§π‡§æ‡§Å ‡§¨‡§∏ ‡§Ø‡•á script ‡§ú‡•ã‡§°‡§º ‡§¶‡•ã -->
<script>
(function(){
  // ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§≤‡•ã‡§°:
  var s=document.createElement('script');
  s.src='https://deepakchauhanxai.com/scripts/ai_bhai_congratulations_popup.js'; // <-- ‡§§‡•Å‡§Æ ‡§Ø‡•á JS ‡§®‡•Ä‡§ö‡•á ‡§µ‡§æ‡§≤‡§æ ‡§ï‡•ã‡§° ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§ï‡•á ‡§á‡§∏ URL ‡§™‡§∞ ‡§∞‡§ñ ‡§¶‡•á‡§®‡§æ
  s.onload=function(){
    // init:
    AIBhaiPopup({
      avatarUrl: 'https://deepakchauhanxai.xyz/images/AI-bhai.png',
      dataUrl:   'https://deepakchauhanxai.xyz/referral/broadcast.json', // ‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç API
      position:  'tl',        // br=bottom-right, bl, tr, tl
      accent:    '#CC5500',   // ‡§•‡•Ä‡§Æ ‡§∞‡§Ç‡§ó
      pollSec:   60           // ‡§ï‡§ø‡§§‡§®‡•á ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç refresh (admin ‡§®‡•á ‡§ï‡•Å‡§õ ‡§®‡§Ø‡§æ ‡§°‡§æ‡§≤‡§æ ‡§§‡•ã)
    });
  };
  document.head.appendChild(s);
})();
</script>
</body>
</html>
