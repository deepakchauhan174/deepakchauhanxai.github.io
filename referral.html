<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepak Chauhan √ó AI Bhai - Referral Program</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --accent: #2dd4bf;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --border: #e2e8f0;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .logo i {
            font-size: 1.8rem;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 16px;
            border-radius: 50px;
            box-shadow: var(--card-shadow);
            font-weight: 500;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Referral Box */
        .referral-box {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .referral-box h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .referral-code {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--primary-dark);
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px dashed var(--primary);
        }

        .text-center {
            text-align: center;
        }

        /* Form Styles */
        .tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .text-muted {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hide {
            display: none;
        }

        /* Profile Stats */
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease;
        }

        /* Leaderboard */
        .leaderboard-top {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .leader-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }

        .rank-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .leader-item.rank-1 {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .leader-item.rank-2 {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
        }

        .leader-item.rank-3 {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
        }

        .leader-score {
            font-weight: 600;
            margin-top: 10px;
            color: var(--dark);
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .list-rank {
            font-weight: 700;
            color: var(--primary);
        }

        .list-name {
            flex: 1;
            margin-left: 15px;
        }

        .list-score {
            font-weight: 600;
            color: var(--dark);
        }

        /* Wallet */
        .wallet-list {
            list-style: none;
        }

        .wallet-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .transaction-credit {
            color: var(--success);
            font-weight: 600;
        }

        .transaction-debit {
            color: var(--danger);
            font-weight: 600;
        }

        .badge {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-top {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .referral-code {
                font-size: 1.5rem;
                padding: 12px;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
       .payout-ticker{
  position: relative;
  overflow: hidden;
  border-radius: 10px;
  margin: 15px 0;
  background: linear-gradient(90deg,#0f172a,#1e293b);
  border: 1px solid rgba(45,212,191,0.3);
  padding: 10px 0;
}

.payout-track{
  display:inline-flex;
  gap:30px;
  white-space:nowrap;
  will-change: transform;
  animation: tickerScroll 35s linear infinite;
  padding-left:100%; /* scroll start outside */
}

.payout-ticker:hover .payout-track{ animation-play-state: paused; }

.payout-chip{
  display:inline-flex; align-items:center; gap:10px;
  padding:6px 14px;
  border-radius:20px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  color:#f8fafc;
  font-size:14px;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
}

.payout-chip .amt{ font-weight:800; color:#2dd4bf; }
.payout-chip .name{ font-weight:700; color:#38bdf8; }
.payout-chip .meta{ color:#94a3b8; font-size:12px }

@keyframes tickerScroll{
  0%{ transform: translateX(0); }
  100%{ transform: translateX(-100%); }
}
    </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <i class="fas fa-rocket"></i>
        <span>Deepak Chauhan √ó AI Bhai</span>
      </div>
      
      <div class="user-badge" id="loginInfo">
        <i class="fas fa-user"></i>
        <span>Guest</span>
      </div>
    </header>

    <a href="https://deepakchauhanxai.com/referral_about.html" 
   style="padding:10px 20px; border-radius:8px; border:1px solid #2dd4bf; 
          color:#2dd4bf; font-weight:600; text-decoration:none; display:inline-block; margin-bottom: 20px;">
   ‚ÑπÔ∏è About AI Bhai
    </a>
    
    <div class="card">
      <div class="referral-box">
        <h3><i class="fas fa-gift"></i> ‡§Ü‡§™‡§ï‡§æ Referral Code</h3>
        <div class="referral-code" id="refView">‚Äî</div>
        <p class="text-center">‡§≤‡§ø‡§Ç‡§ï ‡§∏‡•á ‡§Ü‡§è ‡§π‡•ã ‡§§‡•ã ‡§Ö‡§™‡§®‡•á‚Äë‡§Ü‡§™ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à</p>
      </div>
    </div>

    <!-- AUTH BLOCKS -->
    <div class="card" id="authBlock">
      <h3 class="section-title"><i class="fas fa-user-circle"></i> Sign up / Login</h3>
      
      <div class="tabs">
        <div class="tab active" data-tab="signup">‡§®‡§Ø‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü</div>
        <div class="tab" data-tab="login">Login</div>
      </div>

      <!-- Signup -->
      <div class="tab-content active" id="signupTab">
        <div class="grid-2">
          <div class="form-group">
            <label class="form-label">‡§®‡§æ‡§Æ</label>
            <input id="su_name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ" />
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input id="su_email" type="email" placeholder="email@example.com" />
          </div>
        </div>
        
        <div class="grid-2">
          <div class="form-group">
            <label class="form-label">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (6+ ‡§Ö‡§ï‡•ç‡§∑‡§∞)</label>
            <input id="su_pass" type="password" placeholder="‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" />
          </div>
          <div class="form-group">
            <label class="form-label">OTP (6 digit)</label>
            <div class="grid-2" style="gap: 10px;">
              <button id="su_getotp" class="btn-secondary"><i class="fas fa-key"></i> Get OTP</button>
              <input id="su_otp" placeholder="123456" />
            </div>
          </div>
        </div>
        
        <button id="btnSignup" class="btn btn-success"><i class="fas fa-user-plus"></i> Create Account</button>
        <div class="text-muted mt-20" id="signupMsg"></div>
      </div>

      <!-- Login -->
      <div class="tab-content" id="loginTab">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input id="li_email" type="email" placeholder="email@example.com" />
        </div>
        
        <div class="form-group">
          <label class="form-label">OTP (6 digit)</label>
          <div class="grid-2" style="gap: 10px;">
            <button id="li_getotp" class="btn-secondary"><i class="fas fa-key"></i> Get OTP</button>
            <input id="li_otp" placeholder="123456" />
          </div>
        </div>
        
        <button id="btnLogin" class="btn"><i class="fas fa-sign-in-alt"></i> Login</button>
        <div class="text-muted mt-20" id="loginMsg"></div>
      </div>
    </div>

    <!-- Logged summary -->
    <div class="card hide" id="loggedCard">
      <h3 class="section-title"><i class="fas fa-user-check"></i> Your Profile</h3>
      <div class="grid-2">
        <div>
          <p><strong>Logged in as:</strong> <span id="loggedName">‚Äî</span></p>
          <p class="text-muted">Referral Code: <span id="loggedCode" class="badge"></span></p>
        </div>
        <div>
          <button id="btnLogout" class="btn-secondary"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
      <div class="text-muted mt-20" id="shareWrap">
        <p>Your referral link:</p>
        <div class="referral-code" style="font-size: 18px; padding: 10px;" id="shareLink">‚Äî</div>
        <button class="btn btn-secondary mt-20" onclick="copyLink()"><i class="fas fa-copy"></i> Copy Link</button>
      </div>
    </div>

    <!-- Profile -->
    <div class="card">
      <h3 class="section-title"><i class="fas fa-chart-line"></i> ‡§Æ‡•á‡§∞‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</h3>
      <div class="grid-3">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div>
              <div class="stat-title">Direct Joinings</div>
              <div class="stat-value" id="joinings">0</div>
            </div>
          </div>
          <div class="text-muted">Level Progress: 10 ‚Üí 50 ‚Üí 100 ‚Üí 160</div>
          <div class="progress-bar">
            <div class="progress-fill" id="bar"></div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-percentage"></i>
            </div>
            <div>
              <div class="stat-title">Level Rate</div>
              <div class="stat-value"><span id="rate">0</span>%</div>
            </div>
          </div>
          <div class="text-muted">Auto unlock</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div>
              <div class="stat-title">Wallet Balance</div>
              <div class="stat-value">‚Çπ<span id="balance">0.00</span></div>
            </div>
          </div>
          <div class="text-muted"><a href="#wallet" style="color: var(--accent);">History ‡§¶‡•á‡§ñ‡•á‡§Ç</a></div>
        </div>
      </div>
    </div>

    <!-- Leaderboard -->
  <div class="card">
  <h3 class="section-title"><i class="fas fa-trophy"></i> Leaderboard</h3>

  <!-- üî• New Payout Ticker -->
  <div id="payoutTicker" class="payout-ticker">
    <div class="payout-track" id="payoutTrack"></div>
  </div>

  <!-- Top 3 -->
  <div class="leaderboard-top" id="top3"></div>

  <!-- Next 7 -->
  <ul class="leaderboard-list" id="next7"></ul>
</div>
    <!-- Wallet -->
    <div class="card" id="wallet">
      <h3 class="section-title"><i class="fas fa-history"></i> Wallet History</h3>
      <ul class="wallet-list" id="walletList"></ul>
    </div>

    <div class="card">
      <h3 class="section-title"><i class="fas fa-gift"></i> Future Features</h3>
      <div class="text-muted">Mega Content / Offers / Campaigns / extra bonus /etc.. ‡§ú‡•Å‡§°‡§º‡•á‡§Ç‡§ó‡•á ‚äÇ‚Å†(‚Å†‚óâ‚Å†‚Äø‚Å†‚óâ‚Å†)‚Å†„Å§ Comming üîú ‚äÇ‚Å†(‚Å†‚óâ‚Å†‚Äø‚Å†‚óâ‚Å†)‚Å†„Å§</div>
    </div>
  </div>

<script>
const API_BASE = 'https://deepakchauhanxai.xyz/referral/api';

// capture ref
(function(){
  const u = new URL(location.href);
  const ref = (u.searchParams.get('ref') || '').toUpperCase();
  if(ref){ localStorage.setItem('ref_code', ref); }
  document.getElementById('refView').textContent = localStorage.getItem('ref_code') || '‚Äî';
})();

// Tab functionality
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
  });
});

// Copy referral link function
function copyLink() {
  const link = document.getElementById('shareLink').textContent;
  navigator.clipboard.writeText(link).then(() => {
    alert('Link copied to clipboard!');
  });
}

// state
let currentEmail = localStorage.getItem('my_email') || '';
let currentName  = localStorage.getItem('my_name')  || '';

function maskEmails(str){
  if(!str) return '';
  const emailRegex=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi;
  return str.replace(emailRegex,'hidden');
}

function setLoggedUI(on){
  document.getElementById('authBlock').classList.toggle('hide', on);
  document.getElementById('loggedCard').classList.toggle('hide', !on);
  document.getElementById('loginInfo').innerHTML = on ? `<i class="fas fa-user"></i><span>${currentName || 'User'}</span>` : '<i class="fas fa-user"></i><span>Guest</span>';
}

// --- SIGNUP (OTP) ---
document.getElementById('su_getotp').onclick = async ()=>{
  const email = document.getElementById('su_email').value.trim().toLowerCase();
  if(!email){ alert('Email ‡§≠‡§∞‡•á‡§Ç'); return; }
  const r = await fetch(API_BASE+'/otp_request.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, purpose:'REGISTER'})});
  const j = await r.json(); alert(j.ok?'OTP sent to email':(j.error||'Error'));
};

document.getElementById('btnSignup').onclick = async ()=>{
  const name = document.getElementById('su_name').value.trim();
  const email = document.getElementById('su_email').value.trim().toLowerCase();
  const password = document.getElementById('su_pass').value;
  const otp_code = document.getElementById('su_otp').value.trim();
  const ref = localStorage.getItem('ref_code') || '';
  const msg = document.getElementById('signupMsg');

  if(!name || !email || password.length<6 || !/^\d{6}$/.test(otp_code)){ msg.innerHTML='<span style="color:var(--danger)">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ + OTP ‡§≠‡§∞‡•á‡§Ç</span>'; return; }

  const res = await fetch(API_BASE+'/register.php', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name,email,password,ref,otp_code})});
  const j = await res.json();
  if(!j.ok){ msg.innerHTML='<span style="color:var(--danger)">'+(j.error||'Error')+'</span>'; return; }

  currentEmail=email; currentName=name;
  localStorage.setItem('my_email',email); localStorage.setItem('my_name',name);
  msg.innerHTML='<span style="color:var(--success)">Account ‡§¨‡§® ‡§ó‡§Ø‡§æ</span>';
  afterLoginUI();
};

// --- LOGIN (OTP) ---
document.getElementById('li_getotp').onclick = async ()=>{
  const email = document.getElementById('li_email').value.trim().toLowerCase();
  if(!email){ alert('Email ‡§≠‡§∞‡•á‡§Ç'); return; }
  const r = await fetch(API_BASE+'/otp_request.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, purpose:'LOGIN'})});
  const j = await r.json(); alert(j.ok?'OTP sent to email':(j.error||'Error'));
};

document.getElementById('btnLogin').onclick = async ()=>{
  const email = document.getElementById('li_email').value.trim().toLowerCase();
  const code  = document.getElementById('li_otp').value.trim();
  const msg = document.getElementById('loginMsg');
  if(!email || !/^\d{6}$/.test(code)){ msg.innerHTML='<span style="color:var(--danger)">Email/OTP ‡§∏‡§π‡•Ä ‡§≠‡§∞‡•á‡§Ç</span>'; return; }

  const r = await fetch(API_BASE+'/login_verify.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email, code})});
  const j = await r.json();
  if(!j.ok){ msg.innerHTML='<span style="color:var(--danger)">'+(j.error||'Error')+'</span>'; return; }

  currentEmail=j.data.email; currentName=j.data.name;
  localStorage.setItem('my_email',currentEmail); localStorage.setItem('my_name',currentName);
  msg.innerHTML='<span style="color:var(--success)">Logged in</span>';
  afterLoginUI();
};

// --- After login
async function afterLoginUI(){
  setLoggedUI(true);
  await loadMe();
  await loadWallet();
  await loadLeaderboard();
}

document.getElementById('btnLogout').onclick = ()=>{
  localStorage.removeItem('my_email'); localStorage.removeItem('my_name');
  currentEmail=''; currentName='';
  setLoggedUI(false);
  // ‡§∏‡§æ‡§´ view
  document.getElementById('walletList').innerHTML='';
  document.getElementById('joinings').textContent='0';
  document.getElementById('rate').textContent='0';
  document.getElementById('balance').textContent='0.00';
  document.getElementById('bar').style.width='0%';
};

// --- Me
async function loadMe(){
  if(!currentEmail) return;
  const r = await fetch(API_BASE+'/me.php?email='+encodeURIComponent(currentEmail));
  const j = await r.json(); if(!j.ok) return;
  const me=j.data;

  currentName = me.name || currentName || currentEmail.split('@')[0];
  localStorage.setItem('my_name', currentName);

  setLoggedUI(true);
  document.getElementById('loggedName').textContent=currentName;
  document.getElementById('loginInfo').innerHTML=`<i class="fas fa-user"></i><span>${currentName}</span>`;
  document.getElementById('loggedCode').textContent=me.referral_code;
  const share = location.origin + location.pathname + '?ref=' + me.referral_code;
  document.getElementById('shareLink').textContent = share;

  document.getElementById('joinings').textContent=me.direct_joinings;
  document.getElementById('rate').textContent=me.current_level_rate_percent;
  document.getElementById('balance').textContent=(me.balance_paise/100).toFixed(2);

  const J=me.direct_joinings, cap=J>=160?160: J>=100?100: J>=50?50:10;
  document.getElementById('bar').style.width = Math.min(100, Math.round((J/cap)*100))+'%';
}

// --- Wallet
async function loadWallet(){
  if(!currentEmail) return;
  const r = await fetch(API_BASE+'/wallet_history.php?email='+encodeURIComponent(currentEmail));
  const j = await r.json(); if(!j.ok) return;
  const ul=document.getElementById('walletList'); ul.innerHTML='';
  (j.data.entries||[]).forEach(x=>{
    const ru=(x.amount_paise/100).toFixed(2);
    const sign=x.type==='CREDIT'?'+':'-';
    const safeNote=maskEmails(x.note || x.ref_type);
    const li=document.createElement('li');
    li.innerHTML=`
      <div>
        <div>${safeNote}</div>
        <div class="text-muted">#${x.id}</div>
      </div>
      <div class="${x.type==='CREDIT'?'transaction-credit':'transaction-debit'}">${sign}‚Çπ${ru}</div>
    `;
    ul.appendChild(li);
  });
}

// --- Leaderboard (with client-side fallback sort + joinings display)
async function loadLeaderboard(){
  const r = await fetch(API_BASE + '/leaderboard.php'); 
  const j = await r.json(); 
  if(!j.ok) return;

  // 1) Combine and fallback sort (in case API not sorted correctly)
  let all = [...(j.data.top3 || []), ...(j.data.next7 || [])];

  // normalize
  all = all.map(u => ({
    ...u,
    score_paise: Number(u.score_paise || 0),
    direct_joinings: Number(u.direct_joinings || 0),
    id: Number(u.id || 0),
    name: u.name || 'User'
  }));

  // fallback sort: score desc, joinings desc, id asc
  all.sort((a,b)=>{
    if(a.score_paise !== b.score_paise) return b.score_paise - a.score_paise;
    if(a.direct_joinings !== b.direct_joinings) return b.direct_joinings - a.direct_joinings;
    return a.id - b.id;
  });

  // split back into top3 / next7
  const top3  = all.slice(0,3);
  const next7 = all.slice(3,10);

  // 2) Render
  const fmt = new Intl.NumberFormat('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  const t3 = document.getElementById('top3'); 
  t3.innerHTML = '';
  top3.forEach((u,i)=>{
    const scoreText = u.score_paise > 0 ? ("‚Çπ" + fmt.format(u.score_paise/100)) : "üöÄ Ready to Earn";
    const d = document.createElement('div'); 
    d.className = `leader-item rank-${i+1}`;
    d.innerHTML = `
      <div class="rank-badge">#${i+1}</div>
      <div>${u.name}</div>
      <div class="leader-score">${scoreText} ‚Ä¢ Joinings: ${u.direct_joinings}</div>
    `;
    t3.appendChild(d);
  });

  const n7 = document.getElementById('next7'); 
  n7.innerHTML = '';
  next7.forEach((u,i)=>{
    const scoreText = u.score_paise > 0 ? ("‚Çπ" + fmt.format(u.score_paise/100)) : "üöÄ Ready to Earn";
    const li = document.createElement('li');
    li.innerHTML = `
      <span class="list-rank">#${i+4}</span>
      <span class="list-name">${u.name}</span>
      <span class="list-score">${scoreText} ‚Ä¢ J:${u.direct_joinings}</span>
    `;
    n7.appendChild(li);
  });
}

// boot
(function(){
  const ref = localStorage.getItem('ref_code') || ''; document.getElementById('refView').textContent = ref || '‚Äî';
  if(currentEmail){ setLoggedUI(true); afterLoginUI(); } else { setLoggedUI(false); }
  loadLeaderboard();
})();
</script>
<script>
const API_BASE = "https://deepakchauhanxai.xyz/referral/api"; // ‡§Ö‡§™‡§®‡•Ä API base

function fmtDate(s){
  try{
    const d = new Date((s||'').replace(' ','T'));
    return d.toLocaleDateString('en-IN',{day:'2-digit',month:'short'});
  }catch(e){ return ''; }
}
function inr(paise){ return '‚Çπ'+(paise/100).toFixed(2); }

async function loadPayoutTicker(){
  try{
    const r = await fetch(API_BASE+"/payout_feed_list.php?limit=15",{cache:"no-store"});
    const j = await r.json(); 
    if(!j.ok) return;

    const list = j.data.items||[];
    if(list.length===0) return;

    const track=document.getElementById("payoutTrack");
    track.innerHTML='';

    // ‡§è‡§ï batch render
    const frag=document.createDocumentFragment();
    list.forEach(x=>{
      const chip=document.createElement("span");
      chip.className="payout-chip";
      const title=x.title||"Bonus";
      const note=x.note?` ‚Ä¢ ${x.note}`:"";
      const meta=fmtDate(x.created_at);
      chip.innerHTML=`
        <span>‚úÖ</span>
        <span class="name">${x.display_name}</span>
        <span class="amt">${inr(x.amount_paise)}</span>
        <span class="meta">‚Ä¢ ${title}${note}${meta?' ‚Ä¢ '+meta:''}</span>
      `;
      frag.appendChild(chip);
    });

    // seamless loop ‡§ï‡•á ‡§≤‡§ø‡§è duplicate
    const frag2=frag.cloneNode(true);
    track.appendChild(frag);
    track.appendChild(frag2);

    // dynamic animation duration
    requestAnimationFrame(()=>{
      const w=track.scrollWidth;
      const speed=100; // px per second
      const dur=Math.max(20,Math.round(w/speed));
      track.style.animationDuration=dur+"s";
    });

  }catch(e){ console.error(e); }
}

// load once + ‡§π‡§∞ 60s refresh
loadPayoutTicker();
setInterval(loadPayoutTicker,60000);
</script>
</body>
</html>
