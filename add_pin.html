<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Add Pin</title>
  <style>
    body { font-family: Arial; background: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); width: 400px; }
    input, textarea, select, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
<div class="container">
  <h2>‚ûï Add New Pin</h2>

  <label>üë§ Select Member</label>
  <select id="member"><option>Loading members...</option></select>

  <label>üìå Board</label>
  <select id="board"><option>Select member first</option></select>

  <label>üñºÔ∏è Image URL</label>
  <input type="text" id="image" placeholder="https://example.com/image.jpg" />

  <label>üìå Title</label>
  <input type="text" id="title" placeholder="Enter Pin Title" />

  <label>üìù Description</label>
  <textarea id="description" placeholder="Enter Pin Description"></textarea>

  <label>üè∑Ô∏è Tags (comma separated)</label>
  <input type="text" id="tags" placeholder="tag1, tag2, tag3" />

  <button onclick="submitPin()">Submit</button>
</div>

<script>
  // ‚úÖ Members load karna
  fetch("https://deepakchauhanxai.xyz/pinterest/list_members.php")
    .then(res => res.json())
    .then(data => {
      const memberSelect = document.getElementById("member");
      memberSelect.innerHTML = "";

      if (data.ok && data.members.length > 0) {
        data.members.forEach(m => {
          let option = document.createElement("option");
          option.value = m.id;
          option.setAttribute("board_id", m.board_id); // board_id bhi store kar rahe
          option.textContent = m.name + " (" + m.username + ")";
          memberSelect.appendChild(option);
        });

        // ‚úÖ Agar sirf ek member hai to auto select
        if (data.members.length === 1) {
          memberSelect.selectedIndex = 0;
          loadBoards(data.members[0].id, data.members[0].board_id);
        }
      } else {
        memberSelect.innerHTML = "<option>No members</option>";
      }
    })
    .catch(err => {
      console.error("Member load error:", err);
      document.getElementById("member").innerHTML = "<option>Error loading</option>";
    });

  // ‚úÖ Member select hone par boards load
  document.getElementById("member").addEventListener("change", function () {
    const memberId = this.value;
    const boardId = this.options[this.selectedIndex].getAttribute("data-board");
    loadBoards(memberId, boardId);
  });

  // ‚úÖ Boards load karna
  function loadBoards(memberId, boardId) {
    const boardSelect = document.getElementById("board");
    boardSelect.innerHTML = "";

    if (boardId) {
      let option = document.createElement("option");
      option.value = boardId;
      option.textContent = boardId; // ‡§´‡§ø‡§≤‡§π‡§æ‡§≤ ‡§∏‡§ø‡§∞‡•ç‡§´‡§º board_id ‡§¶‡§ø‡§ñ‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
      boardSelect.appendChild(option);

      // ‚úÖ Agar ek hi board hai to auto select
      boardSelect.selectedIndex = 0;
    } else {
      boardSelect.innerHTML = "<option>No boards</option>";
    }
  }

  // ‚úÖ Pin submit karna
  function submitPin() {
    const formData = new FormData();
    formData.append("member_id", document.getElementById("member").value);
    formData.append("board_id", document.getElementById("board").value);
    formData.append("image_url", document.getElementById("image").value);
    formData.append("title", document.getElementById("title").value);
    formData.append("description", document.getElementById("description").value);
    formData.append("tags", document.getElementById("tags").value);

    fetch("https://deepakchauhanxai.xyz/pinterest/add_pin.php", {
      method: "POST",
      body: formData
    })
      .then(res => res.json())
      .then(data => {
        console.log("Response:", data);
        alert(data.msg);
      })
      .catch(err => {
        console.error("Fetch error:", err);
        alert("‚ùå Network/API error");
      });
  }
</script>
</body>
</html>
