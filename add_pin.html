<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Add Pin</title>
  <style>
    body { font-family: Arial; background: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); width: 400px; }
    input, textarea, select, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
<div class="container">
  <h2>‚ûï Add New Pin</h2>

  <label>üë§ Select Member</label>
  <select id="member"><option>Loading members...</option></select>

  <label>üìå Board</label>
  <select id="board"><option>Select member first</option></select>

  <label>üñºÔ∏è Image URL</label>
  <input type="text" id="image" placeholder="https://example.com/image.jpg" />

  <label>üìå Title</label>
  <input type="text" id="title" placeholder="Enter Pin Title" />

  <label>üìù Description</label>
  <textarea id="description" placeholder="Enter Pin Description"></textarea>

  <label>üè∑Ô∏è Tags (comma separated)</label>
  <input type="text" id="tags" placeholder="tag1, tag2, tag3" />

  <button onclick="submitPin()">Submit</button>
</div>

<script>
async function loadMembers() {
  try {
    const res = await fetch("https://deepakchauhanxai.xyz/pinterest/list_members.php");
    const data = await res.json();
    const memberSelect = document.getElementById("member");
    const boardSelect = document.getElementById("board");
    memberSelect.innerHTML = "";
    if(data.ok && data.members.length > 0) {
      data.members.forEach(m => {
        let option = document.createElement("option");
        option.value = m.id;
        option.setAttribute("data-board", m.board_id);
        option.textContent = m.name + " (" + m.username + ")";
        memberSelect.appendChild(option);
      });
      // Automatic select first member and board
      memberSelect.selectedIndex = 0;
      updateBoard();
    } else {
      memberSelect.innerHTML = "<option>No members</option>";
      boardSelect.innerHTML = "<option>No boards</option>";
    }
  } catch(e) {
    console.error(e);
    document.getElementById("member").innerHTML = "<option>Error loading</option>";
  }
}

function updateBoard() {
  const memberSelect = document.getElementById("member");
  const boardSelect = document.getElementById("board");
  const selectedOption = memberSelect.options[memberSelect.selectedIndex];
  if(selectedOption) {
    const boardId = selectedOption.getAttribute("data-board");
    boardSelect.innerHTML = "";
    let option = document.createElement("option");
    option.value = boardId;
    option.textContent = "Default Board"; // name dikhana
    option.selected = true;
    boardSelect.appendChild(option);
  }
}

document.getElementById("member").addEventListener("change", updateBoard);

async function submitPin() {
  const member = document.getElementById("member").value;
  const board = document.getElementById("board").value;
  const image = document.getElementById("image").value;
  if(!member || !board || !image) { alert("‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç!"); return; }

  const formData = new FormData();
  formData.append("member_id", member);
  formData.append("board_id", board);
  formData.append("image_url", image);
  formData.append("title", document.getElementById("title").value);
  formData.append("description", document.getElementById("description").value);
  formData.append("tags", document.getElementById("tags").value);

  try {
    const res = await fetch("https://deepakchauhanxai.xyz/pinterest/add_pin.php", {method:"POST", body: formData});
    const data = await res.json();
    alert(data.msg || "‚úÖ Pin added successfully!");
  } catch(e) {
    console.error(e);
    alert("‚ùå Network/API error");
  }
}

// Load members on page load
loadMembers();
</script>
</body>
</html>
